//
//  WuXing.c
//  BaZi
//
//  Created by ms on 2017/6/14.
//  Copyright © 2017年 ms. All rights reserved.
//

#include "WuXing.h"
//五行得分 http://blog.sina.com.cn/s/blog_7639c76201015bf3.html
double tgScore[] = {
        1.14,1.14,1.2,1.2,1.06,1.06,1.0,1.0,1.0,1.0,
        1.2,1.2,1.2,1.2,1.0,1.0,1.0,1.0,1.0,1.0,1.1,
        1.1,1.06,1.06,1.1,1.1,1.1,1.1,1.04,1.04,1.0,
        1.0,1.14,1.14,1.14,1.14,1.06,1.06,1.06,1.06,
        1.0,1.0,1.2,1.2,1.2,1.2,1.0,1.0,1.0,1.0,1.04,
        1.04,1.1,1.1,1.16,1.16,1.1,1.1,1.0,1.0,1.06,
        1.06,1.0,1.0,1.0,1.0,1.14,1.14,1.2,1.2,1.0,
        1.0,1.0,1.0,1.0,1.0,1.2,1.2,1.2,1.2,1.0,
        1.0,1.04,1.04,1.14,1.14,1.16,1.16,1.06,1.06,
        1.2,1.2,1.0,1.0,1.0,1.0,1.0,1.0,1.14,1.14,
        1.2,1.2,1.0,1.0,1.0,1.0,1.0,1.0,1.2,1.2,    //子
        1.06,1.06,1.0,1.0,1.1,1.1,1.14,1.14,1.1,1.1    //丑
};

typedef struct _dzStruct{
    int index_tg[3];    //
    double score[3][12];
    int len;                //长度
}dzStruct;

dzStruct dzScore[12]={
    {{9}, {{1.0,1.0,1.04,1.06,1.0,1.0,1.2,1.2,1.06,1.14,1.2,1.1}}, 1},
    {{9, 7, 5}, {{0.3,0.3,0.312,0.318,0.3,0.3,0.36,0.36,0.318,0.342,0.36,0.33},
        {0.2,0.2,0.23,0.212,0.2,0.22,0.228,0.248,0.232,0.2,0.2,0.228},
        {0.53,0.5,0.55,0.57,0.6,0.58,0.5,0.5,0.57,0.5,0.5,0.55}}, 3},
    {{2,0},{{0.36,0.36,0.318,0.342,0.36,0.33,0.3,0.3,0.342,0.318,0.3,0.3},
        {0.798,0.84,0.77,0.7,0.7,0.728,0.742,0.7,0.7,0.84,0.84,0.742}}, 2},
    {{1},{{1.14,1.2,1.1,1.0,1.0,1.04,1.06,1.0,1.0,1.2,1.2,1.06}}, 1},
    {{1,9,4},{{0.342,0.36,0.33,0.3,0.3,0.312,0.318,0.3,0.3,0.36,0.36,0.318},
        {0.2,0.2,0.208,0.2,0.2,0.2,0.24,0.24,0.212,0.228,0.24,0.22},
        {0.53,0.5,0.55,0.6,0.6,0.58,0.5,0.5,0.57,0.5,0.5,0.55}}, 3},
    {{6,2},{{0.3,0.3,0.33,0.3,0.3,0.33,0.342,0.36,0.348,0.3,0.3,0.342},
        {0.84,0.84,0.742,0.84,0.84,0.798,0.7,0.7,0.728,0.742,0.7,0.7}}, 2},
    {{3},{{1.2,1.2,1.06,1.14,1.2,1.1,1.0,1.0,1.04,1.06,1.0,1.0}}, 1},
    {{4,1,5},{{0.36,0.36,0.318,0.342,0.36,0.33,0.3,0.3,0.312,0.318,0.3,0.3},
        {0.228,0.24,0.22,0.2,0.2,0.208,0.212,0.2,0.2,0.24,0.24,0.212},
        {0.53,0.5,0.55,0.57,0.6,0.58,0.5,0.5,0.57,0.5,0.5,0.55}}, 3},
    {{8,6},{{0.3,0.3,0.312,0.318,0.3,0.3,0.36,0.36,0.318,0.342,0.36,0.33},
        {0.7,0.7,0.77,0.742,0.7,0.77,0.798,0.84,0.812,0.7,0.7,0.798}}, 2},
    {{7},{{1.0,1.0,1.1,1.06,1.0,1.1,1.14,1.2,1.16,1.0,1.0,1.14}}, 1},
    {{7,3,4},{{0.3,0.3,0.33,0.318,0.3,0.33,0.342,0.36,0.348,0.3,0.3,0.342},
        {0.24,0.24,0.212,0.228,0.24,0.22,0.2,0.2,0.208,0.212,0.2,0.2},
        {0.53,0.5,0.55,0.57,0.6,0.58,5,0.5,0.57,0.5,0.5,0.55}}, 3},
    {{0,8},{{0.342,0.36,0.33,0.3,0.3,0.312,0.318,0.3,0.3,0.36,0.36,0.318},
        {0.7,0.7,0.728,0.742,0.7,0.7,0.84,0.84,0.724,0.798,0.84,0.77}}, 2}
};

//五行相生
static const int wxSheng[]={2, 0, 4, 3, 1};

/**
 * 天干地支转五行 天干+20
 */
static int coverWuXing(int index) {
    switch (index) {
        case 20:// 甲
        case 21:// 乙
        case 2:// 寅
        case 3:// 卯
            return 1;
        case 22:
        case 23:
        case 5:
        case 6:
            return 3;
        case 24:
        case 25:
        case 4:
        case 1:
        case 10:
        case 7:
            return 4;
        case 26:
        case 27:
        case 8:
        case 9:
            return 0;
        case 28:
        case 29:
        case 11:
        case 0:
            return 2;
    }
    
    return -1;
}

/**
 * 根据天干地支编号获取对应的五行
 * */
void getWuXing(int *gz, int *wx) {
    for(int i=0;i<8;i++)
        wx[i] = coverWuXing(i%2==0?gz[i]+20:gz[i]);
}

void wuXingScore(int *gz, double *wx){
    int i=0;
    int dzMon = gz[3]-2;
    if(dzMon<0)
        dzMon += 11;
    int wxIndex = 0;
    
    for(i=0;i<8;i++){
        if(i%2){    //地支
            int gzIndex =  gz[i];
            for(int j=0; j<dzScore[gzIndex].len; j++){
                wxIndex = coverWuXing(dzScore[gzIndex].index_tg[j]+20);
                wx[wxIndex] += dzScore[gzIndex].score[j][dzMon];
            }
            
            continue;
        }
        
        wxIndex = coverWuXing(gz[i]+20);
        wx[wxIndex] += tgScore[dzMon*10 + gz[i]];
    }
    
    //同类 异类
    int rizhu = coverWuXing(gz[4]+20);
    int shengIndex=-1;
    for (i=0; i<5; i++) {
        if(rizhu == wxSheng[i]){
            shengIndex = i;
            break;
        }
    }
    wx[8] = wxSheng[(shengIndex+1)%5];
    for (i=0; i<5; i++) {
        if(i==rizhu || i==wx[8]){
            wx[5] += wx[i];
            continue;
        }
        wx[6] += wx[i];
    }
    
    wx[7] = wx[5] - wx[6];
}
